define("local_mode_ujian/toggle",["jquery"],(function($){return{init:function(courseid,status,hascap){const isAllowed=hascap;function applyModeUjian(status){$(".course-content .activity").each((function(){const $activity=$(this),isQuiz=$activity.attr("class").includes("modtype_quiz"),instanceName=$activity.find(".instancename").text().trim().toUpperCase(),isExam=isQuiz&&["UTS","UAS","EXAM"].some((keyword=>instanceName.includes(keyword)));"1"==status?isQuiz?isExam||isAllowed?$activity.show():$activity.hide():isAllowed?$activity.show():$activity.hide():$activity.show()}))}function ensureApply(status){let attempts=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;applyModeUjian(status),attempts<10&&setTimeout((()=>ensureApply(status,attempts+1)),300)}ensureApply(status);const toggleWrapper=document.getElementById("mode-ujian-toggle");if(toggleWrapper){const navTabs=document.querySelector(".secondary-navigation")||document.querySelector(".nav-tabs");if(navTabs){const wrapper=document.createElement("div");wrapper.style.display="flex",wrapper.style.justifyContent="flex-end",wrapper.style.margin="2px 6px",wrapper.appendChild(toggleWrapper),navTabs.parentNode.insertBefore(wrapper,navTabs.nextSibling)}}const observerTarget=document.querySelector(".course-content");if(observerTarget){new MutationObserver((()=>{const current=document.querySelector('input[name="exam_mode"]:checked');current&&applyModeUjian(current.value)})).observe(observerTarget,{childList:!0,subtree:!0})}document.querySelectorAll('input[name="exam_mode"]').forEach((input=>{input.addEventListener("change",(function(){const newstatus=this.value;fetch(M.cfg.wwwroot+"/local/mode_ujian/save_mode_ujian.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"courseid="+courseid+"&status="+newstatus}).then((()=>{location.reload(true)})).catch((()=>{location.reload(true)}))}))}))}}}));
